{% extends 'base.html' %}
{% load organization %}

{% block top_level %}
  {% include "template/remove_modal.html" with remove_target_from=shift %}
  {% url 'add_participant_self' shift.pk as add_self_url %}
  {% simpleformmodal 'addSelfForm' _('Add with Name to Shift') add_self_url %}
    {% for field in add_self_form %}
      {% csrf_token %}
      {% bootstrap_field field %}
    {% endfor %}
  {% endsimpleformmodal %}
{% endblock %}

{% block content %}
  <div class="container-fluid container-lg d-flex justify-content-center">
    <div class="col-12 col-md-8">
      <div class="card base-card bg-dark mt-3">
        <div class="card-header center-items justify-content-between">
          <h3 class="m-0">
            {{ shift.name }}
          </h3>
          <div>
            <a class="btn btn-success px-2 py-1" href="{% url 'shift_update' shift.pk %}"
               title="{% trans "Edit Shift" %}">
              <i class="fa-solid fa-pen-to-square"></i>
            </a>
            {% now "Y-m-d" as today %}
            {% if shift.start|date:"Y-m-d" >= today  %}
            <a class="btn btn-danger px-2 py-1" href="{% url 'shift_delete' shift.pk %}"
               title="{% trans "Edit Shift" %}">
              <i class="fa-solid fa-trash"></i>
            </a>
            {% endif %}
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-12 col-md-5">
              <dl class="detail-horizontal">
                <dt>{% trans "Shift Type" %}</dt>
                <dd>{{ shift.shift_type.name }}</dd>
                <dt>{% trans "Place" %}</dt>
                <dd>{{ shift.place }}</dd>
                <dt>{% trans "Start Time" %}</dt>
                <dd>{{ shift.start }}</dd>
                <dt>{% trans "End Time" %}</dt>
                <dd>{{ shift.end }}</dd>
                <dt>{% trans "Organization" %}</dt>
                <dd>
                  <a class="link" href="{{ shift.organization.get_absolute_url }}">
                    {{ shift.organization.name }}
                  </a>
                </dd>
                <dt>{% trans "Created" %}</dt>
                <dd>{{ shift.created }}</dd>
                <dt>{% trans "Last Modified" %}</dt>
                <dd>{{ shift.modified }}</dd>
              </dl>
            </div>
            <div class="col-12 col-md-7">
              <div>
                {% trans "Shift Participants" %}:
                {% if not shift.is_full %}
                  {% has_permission request 'organizations.add_non_members_to_shifts' shift.organization as can_add_others %}
                  {% has_permission request 'organizations.add_members_to_shifts' shift.organization as can_add_members %}
                  {% if can_add_members or can_add_others %}
                    <a class="btn btn-outline-success" href="{% url 'add_participant_other' shift.pk %}">
                      <i class="fa-solid fa-person-circle-plus me-2"></i>{% trans "Add participant" %}
                    </a>
                  {% endif %}
                {% endif %}
              </div>
              <div class="mx-3 mt-2 shift-slots">
                {% for display,required in shift.get_slots_display %}
                  <div class="d-flex{% if required %} shift-required{% endif %}">
                    {% if display %}
                      {% has_permission request 'organizations.remove_others_from_shifts' shift.organization as can_remove_member %}
                      {% if request.user.pk == display.user.pk or can_remove_member %}
                        <button type="button" class="btn border link w-100 mx-2 text-truncate mw-100"
                                data-bs-toggle="modal" data-bs-target="#confirmRemoveModal"
                                data-bs-remove-name="{{ display.display }}"
                                data-bs-remove-url="{% url 'remove_participant' shift.pk display.pk %}"
                                title="{{ display.display }}">
                          {{ display.display }}
                        </button>
                      {% else %}
                        <span class="btn border link pe-none w-100 mx-2">{{ display.display }}</span>
                      {% endif %}
                    {% else %}
                      <button type="button" class="btn border link w-100 mx-2" data-bs-toggle="modal"
                              data-bs-target="#addSelfFormModal">
                        <i class="fa-solid fa-person-circle-plus me-2"></i>{% trans 'Add me' %}
                      </button>
                    {% endif %}
                  </div>
                {% endfor %}
                {% if shift.max_users == 0 %}
                  <div class="d-flex">
                    <button type="button" class="btn border link w-100 mx-2" data-bs-toggle="modal"
                            data-bs-target="#addSelfFormModal">
                      <i class="fa-solid fa-person-circle-plus me-2"></i>{% trans 'Add me' %}
                    </button>
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}